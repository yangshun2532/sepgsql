--@SECURITY_CONTEXT=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c15
SELECT sepgsql_getcon();
                   sepgsql_getcon                    
-----------------------------------------------------
 unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c15
(1 row)

-- cleanup previous tests
SET client_min_messages TO 'error';
SET
DROP DATABASE IF EXISTS d1;
DROP DATABASE
DROP SCHEMA   IF EXISTS s1 CASCADE;
DROP SCHEMA
DROP TABLE    IF EXISTS t2 CASCADE;
DROP TABLE
DROP TABLE    IF EXISTS t1 CASCADE;
DROP TABLE
DROP SEQUENCE IF EXISTS q1 CASCADE;
DROP SEQUENCE
DROP FUNCTION IF EXISTS f1() CASCADE;
DROP FUNCTION
DROP FUNCTION IF EXISTS f2() CASCADE;
DROP FUNCTION
RESET client_min_messages;
RESET
-- DATABASE
CREATE DATABASE d1
    SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0:c0';
CREATE DATABASE
ALTER DATABASE d1
    SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0:c1';
ALTER DATABASE
ALTER DATABASE d1
    SECURITY_LABEL = 'invalid security context';		-- to be failed
ERROR:  Invalid security context: "invalid security context"
ALTER DATABASE d1
    SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0:c16';	-- to be denied
ERROR:  SELinux: security policy violation
-- SCHEMA
CREATE SCHEMA s1
    SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0:c0';
CREATE SCHEMA
ALTER SCHEMA s1
    SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0:c1';
ALTER SCHEMA
ALTER SCHEMA s1
    SECURITY_LABEL = 'invalid security context';		-- to be failed
ERROR:  Invalid security context: "invalid security context"
-- ALTER SCHEMA s1
--     SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0:c16'; -- to be denied
-- TABLE and COLUMNS
CREATE TABLE t1 (
    a   int,
    b   int,
    c   int
        SECURITY_LABEL = 'system_u:object_r:sepgsql_ro_table_t:s0'
) SECURITY_LABEL = 'system_u:object_r:sepgsql_fixed_table_t:s0';
CREATE TABLE
ALTER TABLE t1 SECURITY_LABEL = 'system_u:object_r:sepgsql_table_t:s0:c0';
ALTER TABLE
ALTER TABLE t1 ALTER b SECURITY_LABEL = 'system_u:object_r:sepgsql_table_t:s0:c1';
ALTER TABLE
ALTER TABLE t1 ADD d int SECURITY_LABEL = 'system_u:object_r:sepgsql_table_t:s0:c2';
ALTER TABLE
CREATE TABLE t2 (x int)
    SECURITY_LABEL = 'invalid security context';	-- to be failed
ERROR:  Invalid security context: "invalid security context"
CREATE TABLE t2 (x int)
    SECURITY_LABEL = 'system_u:object_r:sepgsql_table_t:s0:c16';	-- to be failed
ERROR:  SELinux: security policy violation
CREATE TABLE t2 (
    x int SECURITY_LABEL = 'invalid security context'	-- to be failed
);
ERROR:  Invalid security context: "invalid security context"
CREATE TABLE t2 (
    x int SECURITY_LABEL = 'system_u:object_r:sepgsql_table_t:s0:c16'	-- to be failed
);
ERROR:  SELinux: security policy violation
-- SEQUENCE
CREATE SEQUENCE q1
    SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0';
CREATE SEQUENCE
ALTER SEQUENCE q1
    SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0:c0';
ALTER SEQUENCE
ALTER SEQUENCE q1
    SECURITY_LABEL = 'invalid security context';	-- to be failed
ERROR:  Invalid security context: "invalid security context"
-- ALTER SEQUENCE q1
--     SECURITY_LABEL = 'system_u:object_r:sepgsql_db_t:s0:c0';
-- FUNCTION
CREATE FUNCTION f1() RETURNS int LANGUAGE 'sql'
    SECURITY_LABEL = 'system_u:object_r:sepgsql_proc_exec_t:s0:c0'
    AS 'SELECT 1';
CREATE FUNCTION
ALTER FUNCTION f1()
    SECURITY_LABEL = 'system_u:object_r:sepgsql_proc_exec_t:s0:c1';
ALTER FUNCTION
ALTER FUNCTION f1()
    SECURITY_LABEL = 'invalid security context';	-- to be failed
ERROR:  Invalid security context: "invalid security context"
ALTER FUNCTION f1()
    SECURITY_LABEL = 'system_u:object_r:sepgsql_proc_exec_t:s0:c16';	-- to be denied
ERROR:  SELinux: security policy violation
