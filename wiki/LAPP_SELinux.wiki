#labels Phase-Design
= Introduction of LAPP/SELinux =

== Overview ==
The [http://en.wikipedia.org/wiki/LAPP LAPP] is a usual oss web application software stack which consists of Linux, Apache, PostgreSQL and PHP/Perl/Python. The LAPP/SELinux is a concept of our efforts which tries to improve web application security using SELinux. 

[http://www.nsa.gov/research/selinux/index.shtml SELinux] is an implementation of the [http://en.wikipedia.org/wiki/Reference_monitor reference monitor] on the Linux operating system, to provide fine-grained mandatory access controls based on the unified security policy. It has been a mainlined feature and also adopted by major distributions (Fedora, RedHatEL, etc...) for more than five years.
It effectively prevents violated or unexpected accesses on system resources (such as credential files) by buggy applications, so it well contributes competitive edge of the Linux.

However, we often have heard a concern to SELinux, such as _"How does it improve the web application security?"_.
In fact, the trend of threats to our information system has been rapidly changed for a few years.
The following figure is adopted from _[http://www.lac.co.jp/info/jsoc_report/ The analysis report of the trend of intrusions: vol.12 (Mar 16, 2009)]_. It says 93% of significant incidents targeted to web systems in 2008, although it was 53% in 2006.

[http://sepgsql.googlecode.com/files/LAPP_SELinux_Fig00.png]

The rate of attacks to web systems obviously has grew up with expansion of online commerces and enlargement of the worth of information assets via web systems. So, it is necessary to provide a solution to improve the security in the regison, but we also have a few difficult matters.

The one is access controls to database objects. SELinux performs as a reference monitor in operating system, it means SELinux can check all the accesses on resources managed by operating system, but it also means SELinux cannot check anything on resources not managed by operating system, such as database management system.
SE-PostgreSQL is a built-in enhancement of PostgreSQL relational database management system. It enables to apply fine-grained mandatory access controls based on the single unified security policy of SELinux. It also means the coverage of SELinux got enlarged to database layer on LAPP stack.

The other is privileges of web application context. The apache/httpd receives all the http-requests, and handles them in same context with uniformed security context (and user identifier in DAC). It means SELinux cannot discriminate web application contexts invoked by httpd-requests from different users which should perform in different security contexts. The Apache/SELinux plus enables to assign a restrictive security context based on http authentication prior to the invocation of contents handlers (including web application handler) to process user's request. It also means the coverage of SELinux got enlarged to web server layer on LAPP stack.

[http://sepgsql.googlecode.com/files/LAPP_SELinux_Fig01.png]

At the past days, SELinux can control accesses to the resources managed by operating systems.
Nowadays, it can cover the lower LAP of LAPP, and we consider it should cover whole of the LAPP stack.
The final P is symbolically considered as lightweight-languages, such as PHP, but not limited to them.
Any kind of application servers (such as Tomcat) can be a candidate to be deployed here, and its enhancement is a todo item for us in the future.

== Background ==

=== Apache/SELinux plus ===
We can show an analogy between shell login and web accesses.
It will make clear how SELinux should perform in web systems.

In this section, the *user* means a human who would like to access the resources managed by the system, such as a web contents file. In generally, human is not suitable to hardware device by hand, so he creates his *agent* to access the resources instead of him, then he gives a set of orders and receives the result. Because the agent works according to orders from the user, the system needs to assign a correct privileges set which represents the user.

[http://sepgsql.googlecode.com/files/LAPP_SELinux_Fig02.png]

When we access the resource via ssh login, the ssh-server applies identification and authentication, then it forks a child process and execute the login shell with an appropriate user identifier and security context. The user can send a set of operations to access the resource, and the login shell executes them, as far as SELinux allow them.

In the same manner, when we access the resource via web access, the web-server can apply identification and authentication (it also allows anonymous accesses), then it launches a web application instance, as an agent of the user, to handle the given http-request. However, the web-server does not change its security context, so it looks like the web-server process performing as an agent, and SELinux cannot apply valid access controls.

There are few differences between two methods. The user sends his request and authentication information to the server, then the server launches an agent which accesses to the quired resource instead of the user. The only difference is whether the server assigns an appropriate security context, or not.

The Apache/SELinux plus complements the facility. It assigns a corresponding security context based on http authentication prior to the launch of web application instance, as if ssh server assigns a corresponding security context on the user's login shell process.

=== SE-PostgreSQL ===

[http://sepgsql.googlecode.com/files/LAPP_SELinux_Fig03.png]


== Components of LAPP/SELinux ==

=== SELinux ===


=== SE-PostgreSQL ===



=== Apache/SELinux plus ===


[http://sepgsql.googlecode.com/files/LAPP_SELinux_Fig04.png]
[http://sepgsql.googlecode.com/files/LAPP_SELinux_Fig05.png]

=== PHP/SELinux support ===

