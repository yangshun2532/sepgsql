-- 
-- SE-PostgreSQL testcases : row-level access control
-- 
-- selinux_user: unconfined_u
-- selinux_role: unconfined_r
-- selinux_type: sepgsql_test_t
-- selinux_range: s0:c0
-- SELECT, COPY
SELECT security_context, * FROM b1;
                security_context                | x |   y   
------------------------------------------------+---+-------
 unconfined_u:object_r:sepgsql_table_t:s0       | 1 | water
 unconfined_u:object_r:sepgsql_table_t:s0       | 5 | beer
 unconfined_u:object_r:sepgsql_table_t:s0       | 6 | wine
 unconfined_u:object_r:sepgsql_fixed_table_t:s0 | 2 | coke
(4 rows)

SELECT security_context, * FROM b2;
              security_context               | a |   b   
---------------------------------------------+---+-------
 unconfined_u:object_r:sepgsql_table_t:s0    | 1 | red
 unconfined_u:object_r:sepgsql_table_t:s0    | 2 | blue
 unconfined_u:object_r:sepgsql_table_t:s0    | 3 | green
 unconfined_u:object_r:sepgsql_ro_table_t:s0 | 6 | white
(4 rows)

COPY b1 TO stdout;
1	water
5	beer
6	wine
2	coke
COPY b2(security_context,a,b) TO stdout;
unconfined_u:object_r:sepgsql_table_t:s0	1	red
unconfined_u:object_r:sepgsql_table_t:s0	2	blue
unconfined_u:object_r:sepgsql_table_t:s0	3	green
unconfined_u:object_r:sepgsql_ro_table_t:s0	6	white
-- TABLE JOIN
SELECT * FROM b1 JOIN b2 ON b1.x = b2.a;
 x |   y   | a |   b   
---+-------+---+-------
 1 | water | 1 | red
 6 | wine  | 6 | white
 2 | coke  | 2 | blue
(3 rows)

SELECT * FROM b1 LEFT OUTER JOIN b2 ON b1.x = b2.a;
 x |   y   | a |   b   
---+-------+---+-------
 1 | water | 1 | red
 5 | beer  |   | 
 6 | wine  | 6 | white
 2 | coke  | 2 | blue
(4 rows)

SELECT * FROM b1 RIGHT OUTER JOIN b2 ON b1.x = b2.a;
 x |   y   | a |   b   
---+-------+---+-------
 1 | water | 1 | red
 2 | coke  | 2 | blue
   |       | 3 | green
 6 | wine  | 6 | white
(4 rows)

SELECT * FROM b1 FULL OUTER JOIN b2 ON b1.x = b2.a;
 x |   y   | a |   b   
---+-------+---+-------
 1 | water | 1 | red
 2 | coke  | 2 | blue
   |       | 3 | green
 5 | beer  |   | 
 6 | wine  | 6 | white
(5 rows)

-- UPDATE
UPDATE b1 SET y = y || '_updated' RETURNING security_context, *;
             security_context             | x |       y       
------------------------------------------+---+---------------
 unconfined_u:object_r:sepgsql_table_t:s0 | 1 | water_updated
 unconfined_u:object_r:sepgsql_table_t:s0 | 5 | beer_updated
 unconfined_u:object_r:sepgsql_table_t:s0 | 6 | wine_updated
(3 rows)

SELECT security_context, * FROM b1;
                security_context                | x |       y       
------------------------------------------------+---+---------------
 unconfined_u:object_r:sepgsql_fixed_table_t:s0 | 2 | coke
 unconfined_u:object_r:sepgsql_table_t:s0       | 1 | water_updated
 unconfined_u:object_r:sepgsql_table_t:s0       | 5 | beer_updated
 unconfined_u:object_r:sepgsql_table_t:s0       | 6 | wine_updated
(4 rows)

-- DELETE
DELETE FROM b2 RETURNING security_context, *;
             security_context             | a |   b   
------------------------------------------+---+-------
 unconfined_u:object_r:sepgsql_table_t:s0 | 1 | red
 unconfined_u:object_r:sepgsql_table_t:s0 | 2 | blue
 unconfined_u:object_r:sepgsql_table_t:s0 | 3 | green
(3 rows)

SELECT security_context, * FROM b2;
              security_context               | a |   b   
---------------------------------------------+---+-------
 unconfined_u:object_r:sepgsql_ro_table_t:s0 | 6 | white
(1 row)

-- INSERT
INSERT INTO b1 VALUES (10, 'soda');
INSERT INTO b2 VALUES (10, 'orange');
