--@SECURITY_CONTEXT=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c15
SELECT sepgsql_getcon();
                   sepgsql_getcon                    
-----------------------------------------------------
 unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c15
(1 row)

-- cleanup previous tests
SET client_min_messages TO 'error';
SET
DROP TABLE IF EXISTS t1 CASCADE;
DROP TABLE
DROP TABLE IF EXISTS t2 CASCADE;
DROP TABLE
DROP TABLE IF EXISTS t3 CASCADE;
DROP TABLE
RESET client_min_messages;
RESET
-- SETUPS
CREATE TABLE t1
(
    a   int,
    b   int
);
CREATE TABLE
INSERT INTO t1 VALUES (1,1), (2,2);
INSERT 0 2
CREATE TABLE t2
(
    c   text
) INHERITS(t1)
    SECURITY_LABEL = 'system_u:object_r:sepgsql_ro_table_t:s0';
CREATE TABLE
INSERT INTO t2 VALUES (3,3,'ccc');
INSERT 0 1
CREATE TABLE t3
(
    d   text
) INHERITS(t1)
    SECURITY_LABEL = 'system_u:object_r:sepgsql_secret_table_t:s0';
CREATE TABLE
INSERT INTO t3 VALUES (4,4,'ddd');
INSERT 0 1
--@SECURITY_CONTEXT=unconfined_u:unconfined_r:sepgsql_test_t:s0-s0:c0
SELECT sepgsql_getcon();
                  sepgsql_getcon                   
---------------------------------------------------
 unconfined_u:unconfined_r:sepgsql_test_t:s0-s0:c0
(1 row)

SELECT * FROM t1;	-- to be denied
ERROR:  SELinux: security policy violation
SELECT * FROM ONLY t1;
 a | b 
---+---
 1 | 1
 2 | 2
(2 rows)

SELECT * FROM t2;
 a | b |  c  
---+---+-----
 3 | 3 | ccc
(1 row)

SELECT * FROM t3;	-- to be denied
ERROR:  SELinux: security policy violation
UPDATE t1 SET b = b + 1;		-- to be denied
ERROR:  SELinux: security policy violation
UPDATE ONLY t1 SET b = b + 1;
UPDATE 2
UPDATE t2 SET c = c || '_updt';		-- to be denied
ERROR:  SELinux: security policy violation
INSERT INTO t2 VALUES (5,5,'eee');	-- to be denied
ERROR:  SELinux: security policy violation
DELETE FROM t3;		-- to be denied
ERROR:  SELinux: security policy violation
DELETE FROM t1;		-- to be denied
ERROR:  SELinux: security policy violation
DELETE FROM ONLY t1;
DELETE 2
